import React, { useEffect } from 'react';
import { connect } from 'react-redux';
import {
    BrowserRouter as Router,
    Switch,
    Route,
    Redirect,
} from 'react-router-dom';

import Navbar from 'components/Navbar';
import Home from 'pages/Home';
import Login from 'pages/Login';
import Register from 'pages/Register';
import Profile from 'pages/Profile';
import ArticleEditor from 'pages/ArticleEditor';
import { authentication } from 'actions/auth';
// import PrivateRoute from 'components/PrivateRoute';

import './app.scss';

function App({ authentication, isAuthenticated, isFetching, user }) {

    useEffect(() => {
        const token = localStorage.getItem('jwt');
        if (token && !isAuthenticated) {
            authentication(token);
        }
    }, [authentication, isAuthenticated]);

    return (
        <Router>
            <header className="header">
                <Navbar
                    isAuthenticated={isAuthenticated}
                    user={user}
                />
            </header>
            <Switch>
                <Route path="/" component={Home} exact />
                <Route path="/feed" component={Home} />
                <Route path="/login" component={Login} />
                <Route path="/register" component={Register} />

                <Route path="/article" component={Home} exact />
                <Route path="/article/editor" component={ArticleEditor} />
                <Route path="/article/:slug/editor" component={Home} />

                <Route path="/@:username" component={Profile} />
                <Route path="/@:username/favorites" component={Profile} />
                <Redirect to="/" />
            </Switch>
        </Router>
    );
}

const mapStateToProps = (state) => ({
    isFetching: state.auth.isFetching,
    isAuthenticated: state.auth.isAuthenticated,
    user: state.auth.user,
});

const mapDispatchToProps = {
    authentication,
};

export default connect(mapStateToProps, mapDispatchToProps)(App);