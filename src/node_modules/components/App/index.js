import React, { useEffect } from 'react';
import { connect } from 'react-redux';
import {
    BrowserRouter as Router,
    Switch,
    Route,
} from 'react-router-dom';

import Navbar from 'components/Navbar';
import Cover from 'components/Cover';
import Home from 'pages/Home';
import Login from 'pages/Login';
import Register from 'pages/Register';
import Profile from 'pages/Profile';
import { authentication } from 'actions/auth';
import PrivateRoute from 'components/PrivateRoute';

import './app.scss';

function App({ authentication, isAuthenticated, isFetching }) {

    useEffect(() => {
        const token = localStorage.getItem('jwt');
        if (token && !isAuthenticated) {
            authentication(token);
        }
    }, [authentication, isAuthenticated]);

    if (isFetching) {
        return <p>Загрузка...</p>
    }

    return (
        <Router>
            <header className="header">
                <Navbar />
                <Cover />
            </header>
            <Switch>
                <Route path="/" component={Home} exact />
                <Route path="/login" component={Login} />
                <Route path="/register" component={Register} />
                <PrivateRoute path="/profile">
                    <Profile />
                </PrivateRoute>
            </Switch>
        </Router>
    );
}

const mapStateToProps = (state) => ({
    isFetching: state.auth.isFetching,
    isAuthenticated: state.auth.isAuthenticated,
});

const mapDispatchToProps = {
    authentication,
};

export default connect(mapStateToProps, mapDispatchToProps)(App);