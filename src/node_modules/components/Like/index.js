import React, { useState } from 'react';
import { connect } from 'react-redux';
import { Button } from 'antd';
import { LikeOutlined, DislikeOutlined } from '@ant-design/icons';
import Api from 'api';

import './like.scss';

function Like({ favorited, favoritesCount, slug, like, unlike }) {

    const [isFetching, setIsFetching] = useState(false);

    const handleClick = (event) => {
        event.preventDefault();
        if (favorited) {
            setIsFetching(true);
            Api.Articles.unlike(slug).then((result) => {
                console.log(result);
                unlike(result);
                setIsFetching(false);
            });
        } else {
            setIsFetching(true);
            Api.Articles.like(slug).then((result) => {
                console.log(result);
                like(result);
                setIsFetching(false);
            });
        }
    };

    return (
        <Button
            type="primary"
            icon={!favorited ? <LikeOutlined /> : <DislikeOutlined />}
            loading={isFetching}
            onClick={handleClick}
            danger={favorited}
        >
            <span>{favoritesCount}</span>
        </Button>
    );
}

const mapDispatchToProps = (dispatch) => ({
    like: (payload) =>
        dispatch({ type: 'FETCH_LIKE_SUCCESS', payload }),
    unlike: (payload) =>
        dispatch({ type: 'FETCH_UNLIKE_SUCCESS', payload }),
});

export default connect(null, mapDispatchToProps)(Like);