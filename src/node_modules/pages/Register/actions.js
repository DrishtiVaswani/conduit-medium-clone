import { SIGN_UP_FAILURE, SIGN_UP_REQUEST, SIGN_UP_SUCCESS } from './actionTypes';
import { defaultErrorMessage } from '../../constants';
import Api from 'api';

const signUpRequest = () => ({
    type: SIGN_UP_REQUEST,
});

const signUpSuccess = (user) => ({
    type: SIGN_UP_SUCCESS,
    payload: user,
});

const signUpFailure = (errorMessage = defaultErrorMessage) => ({
    type: SIGN_UP_FAILURE,
    payload: errorMessage,
    error: true,
});

export const signUp = (username, email, password) => async (dispatch) => {

    dispatch(signUpRequest());

    try {
        const response = await Api.Auth.register(username, email, password);
        localStorage.setItem('jwt', response.data.user.token);
        dispatch(signUpSuccess(response.data.user));
    } catch (error) {
        localStorage.removeItem('jwt');
        dispatch(signUpFailure(error.response.data.errors));
    }
};