import React, { useState } from 'react';
import PropTypes from 'prop-types';
import { connect } from 'react-redux';
import { Redirect } from 'react-router-dom';
import { Button, TextInput, Alert, Pane } from 'evergreen-ui';

import Layout from 'components/Layout';
import { signUp } from 'actions/auth';

import './register.scss';

function Register({ signUp, isFetching, isAuthenticated, errors }) {

    const [username, setUsername] = useState('');
    const [email, setEmail] = useState('');
    const [password, setPassword] = useState('');

    const handleSubmit = (event) => {
        event.preventDefault();
        signUp(username, email, password);
    };

    if (isAuthenticated) {
        return <Redirect to="/" />
    }

    return (
        <Layout>
            <section className="register">
                <form onSubmit={handleSubmit}>
                    <header className="register-heading">
                        <h1>Регистрация</h1>
                        <p>Быстро и легко.</p>
                    </header>

                    {errors && (
                        <Pane>
                            {Object.keys(errors).map((key) => (
                                <Alert
                                    appearance="card"
                                    intent="danger"
                                    title={`${key} ${errors[key]}`}
                                />
                            ))}
                        </Pane>
                    )}

                    <div>
                        <TextInput
                            required
                            type="text"
                            placeholder="Имя пользователя"
                            value={username}
                            onChange={(e) => setUsername(e.target.value)}
                            width="100%"
                            height={40}
                        />
                    </div>

                    <div>
                        <TextInput
                            required
                            type="email"
                            placeholder="Электронный адрес"
                            value={email}
                            onChange={(e) => setEmail(e.target.value)}
                            width="100%"
                            height={40}
                        />
                    </div>

                    <div>
                        <TextInput
                            required
                            type="password"
                            placeholder="Пароль"
                            value={password}
                            onChange={(e) => setPassword(e.target.value)}
                            width="100%"
                            height={40}
                        />
                    </div>

                    <Button
                        type="submit"
                        appearance="primary"
                        isLoading={isFetching}
                        height={40}
                    >
                        Регистрация
                    </Button>
                </form>
            </section>
        </Layout>
    );
}

Register.propTypes = {
    signUp: PropTypes.func.isRequired,
    isFetching: PropTypes.bool.isRequired,
    isAuthenticated: PropTypes.bool.isRequired,
};

const mapStateToProps = (state) => ({
    isFetching: state.auth.isFetching,
    errors: state.auth.errors,
    isAuthenticated: state.auth.isAuthenticated,
});

const mapDispatchToProps = {
    signUp,
};

export default connect(mapStateToProps, mapDispatchToProps)(Register);