import {
    GET_ARTICLES_BY_AUTHOR_FAILURE,
    GET_ARTICLES_BY_AUTHOR_REQUEST,
    GET_ARTICLES_BY_AUTHOR_SUCCESS,
    GET_PROFILE_FAILURE,
    GET_PROFILE_REQUEST,
    GET_PROFILE_SUCCESS,
} from './actionTypes';
import { defaultErrorMessage } from '../../constants';
import Api from 'api';

const profileRequest = () => ({
    type: GET_PROFILE_REQUEST,
});

const profileSuccess = (profile) => ({
    type: GET_PROFILE_SUCCESS,
    payload: profile,
});

const profileFailure = (errorMessage = defaultErrorMessage) => ({
    type: GET_PROFILE_FAILURE,
    payload: errorMessage,
    error: true,
});

export const fetchProfile = (username) => async (dispatch) => {

    dispatch(profileRequest());

    try {
        const response = await Api.Profile.get(username);
        dispatch(profileSuccess(response.data.profile));
    } catch (error) {
        dispatch(profileFailure(error.response.data.errors));
    }
};

const articlesByAuthorRequest = () => ({
    type: GET_ARTICLES_BY_AUTHOR_REQUEST,
});

const articlesByAuthorSuccess = (articles) => ({
    type: GET_ARTICLES_BY_AUTHOR_SUCCESS,
    payload: articles,
});

const articlesByAuthorFailure = (errorMessage = defaultErrorMessage) => ({
    type: GET_ARTICLES_BY_AUTHOR_FAILURE,
    payload: errorMessage,
    error: true,
});

export const fetchArticlesByAuthor = (author, page) => async (dispatch) => {

    dispatch(articlesByAuthorRequest());

    try {
        const response = await Api.Articles.byAuthor(author, page);
        dispatch(articlesByAuthorSuccess(response.data));
    } catch (error) {
        dispatch(articlesByAuthorFailure(error.response.data.errors));
    }
};