import { SIGN_IN_REQUEST, SIGN_IN_FAILURE, SIGN_IN_SUCCESS } from './actionTypes';
import { defaultErrorMessage } from './constants';
import Api from 'api';

const signInRequest = () => ({
    type: SIGN_IN_REQUEST,
});

const signInSuccess = (user) => ({
    type: SIGN_IN_SUCCESS,
    payload: user,
});

const signInFailure = (errorMessage = defaultErrorMessage) => ({
    type: SIGN_IN_FAILURE,
    payload: errorMessage,
    error: true,
});

export const signIn = (email, password) => async (dispatch) => {

    dispatch(signInRequest());

    try {
        const response = await Api.Auth.login(email, password);
        localStorage.setItem('jwt', response.data.user.token);
        dispatch(signInSuccess(response.data.user));
    } catch (error) {
        localStorage.removeItem('jwt');
        dispatch(signInFailure(error.response.data.errors));
    }

};