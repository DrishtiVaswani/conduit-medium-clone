import {
    FETCH_ARTICLE_REQUEST,
    FETCH_ARTICLE_SUCCESS,
    FETCH_ARTICLE_FAILURE,
    FETCH_COMMENTS_REQUEST,
    FETCH_COMMENTS_SUCCESS,
    FETCH_COMMENTS_FAILURE,
} from './actionTypes';
import { defaultErrorMessage } from 'pages/Article/constants';
import Api from 'api';

const articleRequest = () => ({
    type: FETCH_ARTICLE_REQUEST,
});

const articleSuccess = (article) => ({
    type: FETCH_ARTICLE_SUCCESS,
    payload: article,
});

const articleFailure = (errorMessage = defaultErrorMessage) => ({
    type: FETCH_ARTICLE_FAILURE,
    payload: errorMessage,
    error: true,
});

export const fetchArticle = (slug) => (dispatch) => {

    dispatch(articleRequest());

    Api.Articles.get(slug)
        .then((result) => {
            dispatch(articleSuccess(result.data));
        })
        .catch((error) => {
            dispatch(articleFailure(error.message));
        });
};

const commentsRequest = () => ({
    type: FETCH_COMMENTS_REQUEST,
});

const commentsSuccess = (comments) => ({
    type: FETCH_COMMENTS_SUCCESS,
    payload: comments,
});

const commentsFailure = (errorMessage = defaultErrorMessage) => ({
    type: FETCH_COMMENTS_FAILURE,
    payload: errorMessage,
    error: true,
});

export const fetchComments = (slug) => (dispatch) => {

    dispatch(commentsRequest());

    Api.Comments.forArticle(slug)
        .then((result) => {
            dispatch(commentsSuccess(result.data));
        })
        .catch((error) => {
            dispatch(commentsFailure(error.message));
        });
};